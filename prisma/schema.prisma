generator client {
  provider = "prisma-client"
  output   = "generated"
}

datasource db {
  provider = "postgresql"
}

model users {
  id                     String                  @id @default(ulid())
  name                   String
  email                  String                  @unique
  emailVerified          Boolean                 @default(false)
  image                  String?
  role                   String?                 @default("user")
  banned                 Boolean?                @default(false)
  banReason              String?
  banExpires             DateTime?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @default(now()) @updatedAt
  sessions               sessions[]
  accounts               accounts[]
  todos                  todos[]
  syncSettings           syncSettings?
  matters                matters[]
  matterTypeDeadlines    matterTypeDeadlines[]
  paralegalMetrics       paralegalMetrics[]
  editedMatters          matters[]               @relation("editedMatters")
  deadlineNotifications  deadlineNotifications[]
  editedContacts         contacts[]              @relation("editedContacts")
  editedMatterTypes      matterTypes[]           @relation("editedMatterTypes")
  notificationSettings   notificationSettings?
  notificationRecipients notificationRecipients?
}

model sessions {
  id        String   @id @default(ulid())
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, token])
}

model accounts {
  id                    String    @id @default(ulid())
  accountId             String
  providerId            String
  userId                String
  user                  users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
}

model verifications {
  id         String   @id @default(ulid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@index([identifier])
}

enum TodoStatus {
  pending
  completed
}

model todos {
  id          String     @id @default(ulid())
  title       String
  description String?
  dueTime     DateTime?
  status      TodoStatus @default(pending)
  userId      String
  user        users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model syncSettings {
  id              String    @id @default(ulid())
  userId          String    @unique
  user            users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  pollingInterval Int       @default(30)
  lastSyncAt      DateTime?
  isEnabled       Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
}

enum BillingStatus {
  PAID
  DEPOSIT_PAID
  PAYMENT_PLAN
  DUE
}

model matters {
  id                  String    @id @default(ulid())
  docketwiseId        Int       @unique
  docketwiseCreatedAt DateTime?
  docketwiseUpdatedAt DateTime?
  title               String
  description         String?
  matterType          String?
  matterTypeId        Int?
  status              String?
  statusId            Int?
  statusForFiling     String?
  statusForFilingId   Int?
  clientName          String?
  clientId            Int?
  assignees           String?
  docketwiseUserIds   String?
  openedAt            DateTime?
  closedAt            DateTime?

  assignedDate      DateTime?
  estimatedDeadline DateTime?
  actualDeadline    DateTime?
  billingStatus     BillingStatus?
  totalHours        Float?
  customNotes       String?

  lastSyncedAt DateTime @default(now())
  isStale      Boolean  @default(false)

  isEdited     Boolean   @default(false)
  editedBy     String?
  editedByUser users?    @relation("editedMatters", fields: [editedBy], references: [id], onDelete: SetNull)
  editedAt     DateTime?

  userId    String
  user      users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  deadlineNotifications deadlineNotifications[]

  @@index([docketwiseId])
  @@index([userId])
  @@index([assignedDate])
  @@index([estimatedDeadline])
  @@index([isStale])
}

model matterTypeDeadlines {
  id           String   @id @default(ulid())
  matterType   String
  matterTypeId Int?
  deadlineDays Int
  description  String?
  userId       String
  user         users    @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([userId, matterType])
  @@index([userId])
}

model deadlineNotifications {
  id                 String    @id @default(ulid())
  matterId           String
  matter             matters   @relation(fields: [matterId], references: [id], onDelete: Cascade)
  userId             String
  user               users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  sentAt             DateTime  @default(now())
  recipientEmail     String
  notificationType   String
  daysBeforeDeadline Int
  subject            String
  message            String
  isRead             Boolean   @default(false)
  readAt             DateTime?

  @@index([matterId])
  @@index([userId, isRead])
  @@index([sentAt])
}

model paralegalMetrics {
  id            String   @id @default(ulid())
  paralegalName String
  periodStart   DateTime
  periodEnd     DateTime

  totalMatters        Int    @default(0)
  completedMatters    Int    @default(0)
  staleMatters        Int    @default(0)
  pastDeadlineMatters Int    @default(0)
  avgDaysToFile       Float?
  onTimeFilingRate    Float?

  calculatedAt DateTime @default(now())
  userId       String
  user         users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([paralegalName, periodStart])
  @@index([userId])
}

model docketwiseUsers {
  id           String   @id @default(ulid())
  docketwiseId Int      @unique
  email        String
  firstName    String?
  lastName     String?
  fullName     String?
  isActive     Boolean  @default(true)
  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([docketwiseId])
  @@index([isActive])
}

model contacts {
  id           String  @id @default(ulid())
  docketwiseId Int     @unique
  firstName    String?
  lastName     String?
  middleName   String?
  companyName  String?
  email        String?
  phone        String?
  type         String?
  isLead       Boolean @default(false)

  streetAddress   String?
  apartmentNumber String?
  city            String?
  state           String?
  province        String?
  zipCode         String?
  country         String?

  customNotes  String?
  isEdited     Boolean   @default(false)
  editedBy     String?
  editedByUser users?    @relation("editedContacts", fields: [editedBy], references: [id], onDelete: SetNull)
  editedAt     DateTime?

  // Metadata
  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([docketwiseId])
  @@index([lastName, firstName])
}

model categories {
  id          String   @id @default(ulid())
  name        String   @unique
  description String?
  color       String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  matterTypes matterTypes[]
}

model matterTypes {
  id           String @id @default(ulid())
  docketwiseId Int    @unique
  name         String

  estimatedDays Int?
  categoryId    String?
  category      categories? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  isEdited     Boolean   @default(false)
  editedBy     String?
  editedByUser users?    @relation("editedMatterTypes", fields: [editedBy], references: [id], onDelete: SetNull)
  editedAt     DateTime?

  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  matterStatuses matterStatuses[]

  @@index([docketwiseId])
  @@index([categoryId])
}

model matterStatuses {
  id           String       @id @default(ulid())
  docketwiseId Int          @unique
  name         String
  duration     Int?
  sort         Int?
  matterTypeId String?
  matterType   matterTypes? @relation(fields: [matterTypeId], references: [id], onDelete: SetNull)

  lastSyncedAt DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([docketwiseId])
  @@index([matterTypeId])
}

model notificationSettings {
  id     String @id @default(ulid())
  userId String @unique
  user   users  @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Email notifications
  emailRfe          Boolean @default(true)
  emailApproval     Boolean @default(true)
  emailDenial       Boolean @default(true)
  emailStatusChange Boolean @default(false)
  emailDeadlines    Boolean @default(true)

  // In-app notifications
  inAppRfe          Boolean @default(true)
  inAppApproval     Boolean @default(true)
  inAppDenial       Boolean @default(true)
  inAppStatusChange Boolean @default(true)
  inAppDeadlines    Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model notificationRecipients {
  id           String  @id @default(ulid())
  userId       String  @unique
  user         users   @relation(fields: [userId], references: [id], onDelete: Cascade)
  emailEnabled Boolean @default(true)
  inAppEnabled Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
